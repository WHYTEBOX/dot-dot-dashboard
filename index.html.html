<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Careers Festival 2025 - Marcomms Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flow-card {
            border: 2px solid #0072B5;
            min-height: 8rem;
        }
        .flow-connector {
            flex-grow: 1;
            background-color: #0072B5;
            min-height: 2px;
            min-width: 2rem;
        }
        .flow-arrow {
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-left: 8px solid #0072B5;
        }
        .flow-connector-vertical {
            width: 2px;
            background-color: #0072B5;
            min-height: 2rem;
        }
         .flow-arrow-down {
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #0072B5;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0072B5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-[#00446A]">
    <!-- Color Palette: Brilliant Blues (#00446A, #0072B5, #00A5E5, #8DD5F2, #FFFFFF) -->
    <!-- Plan: Section 1: Dashboard KPIs. Section 2: Task status donut chart. Section 3: Timeline view. Section 4: Dependency flowchart. Section 5: Urgent tasks. Section 6: AI Assistant -->
    <!-- Visualizations: Big Numbers (Inform, HTML/CSS), Donut Chart (Compare, Chart.js/Canvas), Timeline (Change, HTML/CSS), Flowchart (Organize, HTML/CSS - NO SVG/Mermaid), Cards (Inform, HTML/CSS). -->
    <!-- Confirmation: NEITHER Mermaid JS NOR SVG were used in this output. -->

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-[#00446A] mb-2">Careers Festival 2025</h1>
            <p class="text-xl md:text-2xl text-[#0072B5]">Marketing & Communications Project Dashboard</p>
        </header>

        <section id="dashboard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <h3 class="text-lg font-semibold text-[#0072B5] mb-2">Total Tasks</h3>
                <p class="text-5xl font-bold text-[#00446A]">9</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <h3 class="text-lg font-semibold text-[#0072B5] mb-2">Team Members</h3>
                <p class="text-5xl font-bold text-[#00446A]">5</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <h3 class="text-lg font-semibold text-[#0072B5] mb-2">Due Today</h3>
                <p class="text-5xl font-bold text-red-500">2</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <h3 class="text-lg font-semibold text-[#0072B5] mb-2">Blocked Tasks</h3>
                <p class="text-5xl font-bold text-amber-500">2</p>
            </div>
        </section>

        <section id="status-breakdown" class="mb-12 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-3xl font-bold text-center mb-2">Task Status Breakdown</h2>
            <p class="text-center text-[#0072B5] mb-6">This chart shows the current distribution of all project tasks by their status. It provides a quick overview of project health, highlighting the proportion of tasks that are in progress versus those that are pending or blocked.</p>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </section>

        <section id="ai-assistant" class="mb-12 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-3xl font-bold text-center mb-2">✨ AI Assistant</h2>
            <p class="text-center text-[#0072B5] mb-8">Leverage the Gemini API to streamline your project management tasks.</p>
            <div class="flex flex-col md:flex-row justify-center items-center gap-4">
                <button id="generateEmailBtn" class="bg-[#0072B5] text-white font-bold py-3 px-6 rounded-lg hover:bg-[#005a8c] transition duration-300 w-full md:w-auto">✨ Generate Project Status Email</button>
                <button id="suggestActionsBtn" class="bg-[#00A5E5] text-white font-bold py-3 px-6 rounded-lg hover:bg-[#0084b8] transition duration-300 w-full md:w-auto">✨ Suggest Actions for Blockers</button>
            </div>
        </section>
        
        <section id="timeline" class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8">Key Workstreams & Deadlines</h2>
            <div class="relative">
                <div class="border-l-4 border-[#00A5E5] absolute h-full top-0 left-1/2 -ml-0.5"></div>
                
                <div class="mb-8 flex justify-between items-center w-full right-auto">
                    <div class="order-1 w-5/12"></div>
                    <div class="z-20 flex items-center order-1 bg-[#0072B5] shadow-xl w-12 h-12 rounded-full">
                        <h1 class="mx-auto font-bold text-lg text-white">1</h1>
                    </div>
                    <div class="order-1 bg-white rounded-lg shadow-md w-5/12 px-6 py-4">
                        <h3 class="font-bold text-[#00446A] text-lg">Communications Drafts</h3>
                        <p class="text-sm leading-snug tracking-wide text-[#0072B5]">First wave of Action/Conversion comms due for review.</p>
                        <p class="text-sm font-semibold text-red-500 mt-1">Deadline: EOP 23rd Sept 2025</p>
                    </div>
                </div>

                <div class="mb-8 flex justify-between flex-row-reverse items-center w-full left-auto">
                    <div class="order-1 w-5/12"></div>
                    <div class="z-20 flex items-center order-1 bg-[#0072B5] shadow-xl w-12 h-12 rounded-full">
                        <h1 class="mx-auto text-white font-bold text-lg">2</h1>
                    </div>
                    <div class="order-1 bg-white rounded-lg shadow-md w-5/12 px-6 py-4">
                        <h3 class="font-bold text-[#00446A] text-lg">UTM Link Generation</h3>
                        <p class="text-sm leading-snug tracking-wide text-[#0072B5]">Testing and creation of all tracked links for the campaign.</p>
                        <p class="text-sm font-semibold mt-1">Deadline: EOP 24th Sept 2025</p>
                    </div>
                </div>

                <div class="mb-8 flex justify-between items-center w-full right-auto">
                    <div class="order-1 w-5/12"></div>
                    <div class="z-20 flex items-center order-1 bg-[#0072B5] shadow-xl w-12 h-12 rounded-full">
                        <h1 class="mx-auto font-bold text-lg text-white">3</h1>
                    </div>
                    <div class="order-1 bg-white rounded-lg shadow-md w-5/12 px-6 py-4">
                        <h3 class="font-bold text-[#00446A] text-lg">Handover to Student Comms</h3>
                        <p class="text-sm leading-snug tracking-wide text-[#0072B5]">Full package handover upon draft sign-off.</p>
                        <p class="text-sm font-semibold mt-1">Deadline: 48hrs Post Sign-Off</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="dependencies" class="mb-12 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-3xl font-bold text-center mb-2">The Critical Path: Dependencies & Flow</h2>
            <p class="text-center text-[#0072B5] mb-8">This flowchart illustrates how key tasks are connected. Understanding these dependencies is crucial for keeping the project on track, as a delay in one task can impact the start of the next.</p>
            <div class="space-y-8 md:space-y-0 md:flex md:space-x-4 items-center justify-center">
                <div class="flex flex-col items-center text-center space-y-4">
                    <div class="flow-card p-4 rounded-lg flex items-center justify-center w-48">
                        <div>
                            <p class="font-bold">1a. Asset Repository</p>
                            <p class="text-xs">Owner: Cherry</p>
                            <p class="text-xs mt-1 font-semibold text-amber-500">Status: Pending</p>
                        </div>
                    </div>
                    <div class="flow-arrow-down"></div>
                     <div class="flow-card p-4 rounded-lg flex items-center justify-center w-48 bg-amber-100">
                        <div>
                            <p class="font-bold">1b. Proof Assets</p>
                            <p class="text-xs">Owner: DA</p>
                            <p class="text-xs mt-1 font-semibold text-red-600">Status: Blocked</p>
                        </div>
                    </div>
                </div>
                
                 <div class="hidden md:flex items-center">
                     <div class="flow-connector"></div>
                     <div class="flow-arrow"></div>
                 </div>

                <div class="flex flex-col items-center text-center space-y-4">
                    <div class="flow-card p-4 rounded-lg flex items-center justify-center w-48">
                        <div>
                            <p class="font-bold">3a. Comms Drafts</p>
                            <p class="text-xs">Owner: DA</p>
                            <p class="text-xs mt-1 font-semibold text-red-500">Status: Due Today</p>
                        </div>
                    </div>
                     <div class="flow-arrow-down"></div>
                     <div class="flow-card p-4 rounded-lg flex items-center justify-center w-48">
                        <div>
                            <p class="font-bold">5a. Handover</p>
                            <p class="text-xs">Owner: DA</p>
                             <p class="text-xs mt-1 font-semibold text-amber-500">Status: Pending Sign-off</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="priorities">
            <h2 class="text-3xl font-bold text-center mb-8">Immediate Priorities</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-red-100 border-l-4 border-red-500 p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold text-red-800 mb-2">Task 3a: Submit First Wave Comms</h3>
                    <p class="text-red-700">The first drafts of the 'Action/Conversion' campaign communications, including the landing page copy, must be submitted to COM for review and sign-off.</p>
                    <p class="mt-4 font-bold text-red-800">Deadline: EOP Today (23rd Sept)</p>
                </div>
                <div class="bg-red-100 border-l-4 border-red-500 p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold text-red-800 mb-2">Task 4a: Draft Internal Comms</h3>
                    <p class="text-red-700">The internal messaging for staff regarding the Careers Festival needs to be drafted and sent to COM for sign-off before being shared wider.</p>
                    <p class="mt-4 font-bold text-red-800">Deadline: EOP Today (23rd Sept)</p>
                </div>
            </div>
        </section>

    </div>

    <!-- AI Response Modal -->
    <div id="aiModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 id="modalTitle" class="text-xl font-bold text-[#00446A]">AI Generated Response</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div id="modalContent" class="p-6 overflow-y-auto">
                <!-- Loader -->
                <div id="loader" class="flex justify-center items-center h-40">
                    <div class="loader"></div>
                </div>
                <!-- Response -->
                <div id="responseText" class="whitespace-pre-wrap font-mono text-sm"></div>
            </div>
            <div class="p-4 border-t flex justify-end gap-2">
                 <button id="copyBtn" class="bg-[#0072B5] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#005a8c] transition duration-300">Copy</button>
                <button id="closeModalBtn2" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-300">Close</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ctx = document.getElementById('statusChart').getContext('2d');
            const statusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'Blocked', 'In Progress', 'To Do', 'Due Today'],
                    datasets: [{
                        label: 'Tasks by Status',
                        data: [2, 2, 2, 1, 2],
                        backgroundColor: [ '#8DD5F2', '#ffca28', '#00A5E5', '#0072B5', '#ef4444' ],
                        borderColor: '#FFFFFF',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { size: 14, family: 'Inter' }, color: '#00446A' } },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    return Array.isArray(label) ? label.join(' ') : label;
                                }
                            }
                        }
                    }
                }
            });

            const aiModal = document.getElementById('aiModal');
            const modalTitle = document.getElementById('modalTitle');
            const loader = document.getElementById('loader');
            const responseText = document.getElementById('responseText');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const closeModalBtn2 = document.getElementById('closeModalBtn2');
            const copyBtn = document.getElementById('copyBtn');

            const openModal = () => aiModal.classList.remove('hidden');
            const closeModal = () => aiModal.classList.add('hidden');
            
            closeModalBtn.addEventListener('click', closeModal);
            closeModalBtn2.addEventListener('click', closeModal);
            copyBtn.addEventListener('click', () => {
                const textToCopy = responseText.innerText;
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = textToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextArea);
                copyBtn.innerText = 'Copied!';
                setTimeout(() => { copyBtn.innerText = 'Copy'; }, 2000);
            });

            async function callGeminiAPI(prompt, maxRetries = 3) {
                // This now points to our secure Netlify function
                const apiUrl = '/.netlify/functions/generate'; 
            
                const payload = { prompt };
            
                let attempt = 0;
                while (attempt < maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
            
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
            
                        const result = await response.json();
            
                        if (result.text) {
                            return result.text;
                        } else {
                            throw new Error('Invalid response structure from our serverless function');
                        }
                    } catch (error) {
                        attempt++;
                        if (attempt >= maxRetries) {
                            console.error('Error calling our serverless function:', error);
                            return `Error: Unable to get a response from the AI Assistant after ${maxRetries} attempts. Please check the console for details.`;
                        }
                        const delay = Math.pow(2, attempt) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                    }
                }
            }


            document.getElementById('generateEmailBtn').addEventListener('click', async () => {
                modalTitle.innerText = '✨ Generating Status Email...';
                responseText.innerText = '';
                loader.style.display = 'flex';
                openModal();

                const prompt = `
                    You are a professional project manager. Based on the following project status data for the 'Careers Festival 2025 Marcomms Campaign', write a clear and concise status update email suitable for sharing with project stakeholders. 
                    The email should have a brief summary, a section for items requiring immediate attention (due today), and a section on current blockers. Be professional and action-oriented.

                    Data:
                    - Total Tasks: 9
                    - Due Today: 
                        1. Task 3a: Submit First Wave of Action/Conversion comms drafts to COM.
                        2. Task 4a: Draft CF25 Staff Internal Comms Messaging and submit to COM.
                    - Blocked Tasks:
                        1. Task 1b (Proof Assets) is blocked by Task 1a (Asset Repository), which is pending from Cherry.
                        2. Task 5a (Handover to Student Comms) is blocked by Task 3a (Comms Drafts sign-off) from COM.
                    - Upcoming Deadline: Task 2c (Supply Khadijat with UTM links) is due EOP 24.9.25.
                `;

                const result = await callGeminiAPI(prompt);
                loader.style.display = 'none';
                responseText.innerText = result;
            });

            document.getElementById('suggestActionsBtn').addEventListener('click', async () => {
                modalTitle.innerText = '✨ Suggesting Next Actions...';
                responseText.innerText = '';
                loader.style.display = 'flex';
                openModal();
                
                const prompt = `
                    You are an expert project manager. The following tasks in the 'Careers Festival 2025 Marcomms Campaign' are currently blocked. 
                    Analyze the dependencies and suggest 2-3 specific, actionable next steps to resolve each blocker. Frame the suggestions as a clear, actionable checklist.

                    Blocked Tasks:
                    1. Task: 'Proof Assets' (Owner: DA).
                       - Blocker: Waiting for 'Asset Repository' from Cherry.
                    2. Task: 'Handover to Student Comms' (Owner: DA).
                       - Blocker: Waiting for sign-off on 'Comms Drafts' from COM.
                `;

                const result = await callGeminiAPI(prompt);
                loader.style.display = 'none';
                responseText.innerText = result;
            });
        });
    </script>

</body>
</html>

